--- a/focusd/firefox_doh.py
+++ b/focusd/firefox_doh.py
@@ -6,6 +6,7 @@ Prevents Firefox from bypassing DNS blocking via encrypted DNS.

 import logging
 from pathlib import Path
+import os
 from typing import List, Set

 logger = logging.getLogger(__name__)
@@ -23,10 +24,15 @@ class FirefoxDoHManager:
     """

     FIREFOX_PREF_DIR = Path("/etc/firefox/pref")
     FOCUSD_PREF_FILE = FIREFOX_PREF_DIR / "focusd.js"
+    NIXOS_STATE_FILE = Path("/var/lib/focusd/firefox-excluded-domains")
+    NIXOS_UPDATE_SCRIPT = "/run/current-system/sw/bin/focusd-update-firefox"

     def __init__(self):
+        # Check if running on NixOS
+        self.is_nixos = os.environ.get('FOCUSD_NIXOS', '0') == '1' or \
+                        Path('/etc/NIXOS').exists()
         self.firefox_available = self.FIREFOX_PREF_DIR.exists()
-        if not self.firefox_available:
+        if not self.firefox_available and not self.is_nixos:
             logger.debug("Firefox preference directory not found, DoH exclusions disabled")

     def enable_doh_exclusions(self, profile_name: str, blocked_domains: List[str],
@@ -40,8 +46,26 @@ class FirefoxDoHManager:
             path_rule_domains: List of domains with path rules (also need DNS inspection)
         """
-        if not self.firefox_available:
+        # NixOS-specific implementation
+        if self.is_nixos:
+            try:
+                all_domains = set(blocked_domains + path_rule_domains)
+                if not all_domains:
+                    return
+
+                # Write domains to state file, one per line
+                self.NIXOS_STATE_FILE.write_text('\n'.join(sorted(all_domains)))
+
+                # Trigger NixOS update script
+                import subprocess
+                subprocess.run([str(self.NIXOS_UPDATE_SCRIPT)], check=False, timeout=10)
+                logger.info(f"Firefox DoH exclusions updated for NixOS ({len(all_domains)} domains)")
+            except Exception as e:
+                logger.error(f"Failed to update Firefox DoH exclusions on NixOS: {e}")
+            return
+
+        # Original implementation for non-NixOS systems
+        if not self.firefox_available:
             logger.debug("Firefox not available, skipping DoH exclusions")
             return

@@ -75,6 +99,17 @@ class FirefoxDoHManager:

     def disable_doh_exclusions(self):
         """Remove blocked domains from Firefox DoH exclusions."""
+        # NixOS-specific implementation
+        if self.is_nixos:
+            try:
+                if self.NIXOS_STATE_FILE.exists():
+                    self.NIXOS_STATE_FILE.unlink()
+                import subprocess
+                subprocess.run([str(self.NIXOS_UPDATE_SCRIPT)], check=False, timeout=10)
+                logger.info("Firefox DoH exclusions disabled on NixOS")
+            except Exception as e:
+                logger.error(f"Failed to disable Firefox DoH exclusions on NixOS: {e}")
+            return
+
         if not self.firefox_available:
             return

@@ -91,4 +126,6 @@ class FirefoxDoHManager:

     def is_active(self) -> bool:
         """Check if DoH exclusions are currently active."""
+        if self.is_nixos:
+            return self.NIXOS_STATE_FILE.exists() and self.NIXOS_STATE_FILE.stat().st_size > 0
         return self.firefox_available and self.FOCUSD_PREF_FILE.exists()
